
<project name="RelayConnector" default="all" basedir=".">
   

	<target name="init">
		<property file="user.properties"/>
		<property name="projectfile" value="project.xml"/>
		<xmlproperty file="${projectfile}"/>
		<property file="buildnumber.properties"/>
		<property name="srcdir" value="src"/>
		<property name="libdir" value="lib"/>
		<property name="builddir" value="build"/>
		<property name="distname" value="${project.name}-${project.version}"/>
		<property name="isvfile"  value="${builddir}/${distname}.${buildnumber}.isvp"/>
		<mkdir dir="${builddir}" />
		<mkdir dir="${builddir}/classes" />
		<mkdir dir="${builddir}/files" />
	</target>

	<target name="compile" description="Compiles Java files" depends="init">
		<javac srcdir="${srcdir}/java" destdir="${builddir}/classes" debug="on" optimize="on">
			<include name="**/*.java"/>
			<classpath>
				<pathelement path="${libdir}/cordys/wcp.jar" />
				<pathelement path="${libdir}/cordys/coelib.jar" />
				<pathelement path="${libdir}/cordys/ldap.jar" />
				<pathelement path="${libdir}/commons-httpclient-3.1.jar" />
			</classpath>
		</javac>
		<copy todir="${builddir}/classes">
			<fileset dir="${srcdir}/java">
				<patternset><include name="**/coelib.version"/></patternset>
			</fileset>
		</copy>
	</target>

	<target name="jar" description="creates a jar file" depends="compile">
		<jar jarfile="${builddir}/files/${distname}.jar"  basedir="${builddir}/classes"/>
	</target>

	<target name="isv" description="creates the ISV file" depends="jar">
		<copy todir="${builddir}/files">
			<fileset dir="${srcdir}">
				<patternset>
					<include name="web/relayconfig.html"/>
					<include name="isv.xml"/>
				</patternset>
			</fileset>
			<filterset>
				<filter token="PROJECT" value="${project.name}"/>
				<filter token="VERSION" value="${project.version}"/>
				<filter token="BUILDNUMBER" value="${buildnumber}"/>
				<filter token="PACKAGE" value="org.kisst.cordys.relay"/>
			</filterset>
		</copy>
		<copy todir="${builddir}/files" file="${libdir}/cordys/coelib.jar"/>
		<copy todir="${builddir}/files/web" file="${libdir}/cordys/coelib.js"/>
		<zip destfile="${isvfile}"  basedir="${builddir}/files"/>
	</target>

	<target name="isv-http" description="creates the ISV file" depends="jar">
		<copy todir="${builddir}/files">
			<fileset dir="${srcdir}">
				<patternset>
					<include name="web/relayconfig.html"/>
					<include name="isv.xml"/>
				</patternset>
			</fileset>
			<filterset>
				<filter token="PROJECT" value="${project.name}"/>
				<filter token="VERSION" value="${project.version}"/>
				<filter token="BUILDNUMBER" value="${buildnumber}"/>
				<filter token="PACKAGE" value="org.kisst.cordys.http"/>
			</filterset>
		</copy>
		<copy todir="${builddir}/files" file="${libdir}/cordys/coelib.jar"/>
		<copy todir="${builddir}/files/web" file="${libdir}/cordys/coelib.js"/>
		<copy todir="${builddir}/files" file="${libdir}/commons-httpclient-3.1.jar"/>
		<zip destfile="${isvfile}"  basedir="${builddir}/files"/>
	</target>


	<target name="all" depends="isv"/>

	<target name="scp-jar" depends="jar">
		<exec executable="scp">
			<arg value="${builddir}/files/${distname}.jar"/>
			<arg value="${cordys_scp_url}/kisst.org/${distname}"/>
		</exec>
	</target>


	<target name="scp-isv" depends="isv">
		<exec executable="scp">
			<arg value="${isvfile}"/>
			<arg value="${cordys_scp_url}/Web/wcp/isvcontent/packages"/>
		</exec>
	</target>

	<target name="copy-jar" depends="jar">
		<copy file="${builddir}/files/${distname}.jar" todir="${cordys_scp_url}/kisst.org"/>
	</target>


	<target name="copy-isv" depends="isv">
		<copy file="${isvfile}" todir="${cordys_scp_url}/Web/wcp/isvcontent/packages"/>
	</target>

	<target name="setup-ibiblio" depends="init">
		<get src="http://www.ibiblio.org/maven/commons-httpclient/jars/commons-httpclient-3.1.jar" dest="lib/commons-httpclient-3.1.jar"/>
		<get src="http://www.ibiblio.org/maven/commons-logging/jars/commons-logging-1.0.4.jar" dest="lib/commons-logging-1.0.4.jar"/>
		<get src="http://www.ibiblio.org/maven/commons-codec/jars/commons-codec-1.2.jar" dest="lib/commons-codec-1.2.jar"/>
	</target>

	<target name="setup-copy" depends="init">
		<mkdir dir="lib/cordys" />
		<copy todir="lib/cordys" file="${cordys_dir}/WCP/wcp.jar"/>
		<copy todir="lib/cordys" file="${cordys_dir}/WCP/ldap.jar"/>
		<copy todir="lib/cordys" file="${cordys_dir}/coe/coelib/coelib.jar"/>
		<copy todir="lib/cordys" file="${cordys_dir}/web/coe/coelib/coelib.js"/>
	</target>

	<target name="setup-scp" depends="init">
		<mkdir dir="lib/cordys" />
		<exec executable="scp">
			<arg value="${cordys_scp_url}/WCP/wcp.jar"/>
			<arg value="${cordys_scp_url}/WCP/ldap.jar"/>
			<arg value="${cordys_scp_url}/coe/coelib/coelib.jar"/>
			<arg value="${cordys_scp_url}/web/coe/coelib/coelib.js"/>
			<arg value="lib/cordys"/>
		</exec>
	</target>
	
	<target name="clean" >
  		<delete dir="${builddir}" />
  	</target>

	<target name="isv-xml" depends="init">
		<xslt in="${projectfile}" out="build/isv.xml"  style="sbf/create-isv.xsl">
			<outputproperty name="indent" value="yes"/>
			<param name="ORG" expression="${project.org}"/>
			<param name="PROJECT" expression="${project.name}"/>
			<param name="VERSION" expression="${project.version}"/>
			<param name="BUILDNUMBER" expression="${buildnumber}"/>
			<param name="PACKAGE" expression="org.kisst.cordys.relay"/>
		</xslt>
	</target>

</project>
